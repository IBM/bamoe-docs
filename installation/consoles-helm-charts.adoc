= Installing BAMOE Management Console
include::../partials/attributes.adoc[]

You can install {MANAGEMENT_CONSOLE} via Helm Chart or via Docker.

== Using the Helm Chart
Helm, https://helm.sh/[the package manager for Kubernetes] enables you to manage Kubernetes applications and Helm Charts help you to define, install and upgrade even the most complex Kubernetes applications. 

BAMOE Consoles is a Helm Chart based on the open-source Apache KIE Runtime Tools Consoles Helm Chart that can be used to deploy the BAMOE Management Console image on a Kubernetes cluster using the Helm package manager.


===  Additional requirements

* Podman (for Linux)
* Docker (for macOS)
* Minikube

===  Components

* BAMOE Management Console 

===  Installing the Chart

Use the following command to do a default installation:

    $ helm install bamoe-consoles oci://quay.io/bamoe/consoles-helm-chart --version={VERSION}

==== Minikube install

Use the following commands to do a Minikube install if you wish to run a single-node Kubernetes cluster in a virtual machine on your machine:

    $ helm pull oci://quay.io/bamoe/consoles-helm-chart --version={VERSION} --untar
    $ helm install bamoe-consoles ./consoles-helm-chart --values ./consoles-helm-chart/values-minikube-nginx.yaml --set global.dataIndexUrl="<KOGITO_DATA_INDEX_SERVICE_URL>"

==== Kubernetes install

If you want to install the Management console directly on a Kubernetes cluster, you may need to get the default Kubernetes cluster domain for your Ingress using this command:

    $ kubectl get --all-namespaces ingress -o json 2> /dev/null| jq -r '.items[] | .spec.rules[] | .host as $host | .http.paths[] | ( $host )' | sort | grep -v ^/

You can then run the following helm commands:

    $ helm pull oci://quay.io/bamoe/consoles-helm-chart --version={VERSION} --untar
    $ helm install bamoe-consoles ./consoles-helm-chart --values ./consoles-helm-chart/values-kubernetes.yaml --set global.dataIndexUrl="<DATA_INDEX_SERVICE_URL>" --set global.kubernetesClusterDomain="<YOUR_KUBERNETES_CLUSTER_DOMAIN>" --set global.kubernetesIngressClass="<YOUR_KUBERNETES_INGRESS_CLASS>"

====  OpenShift install

First, you may need to get the default OpenShift domain for your routes with this command:

    $ oc get ingresses.config cluster --output jsonpath={.spec.domain}

If you do not have access rights to this config, try creating a dummy Route resource and checking its domain.

    $ helm pull oci://quay.io/bamoe/consoles-helm-chart --version={VERSION} --untar
    $ helm install bamoe-consoles ./consoles-helm-chart --values ./consoles-helm-chart/values-openshift.yaml --set global.dataIndexUrl="<DATA_INDEX_SERVICE_URL>" --set global.openshiftRouteDomain="<YOUR_OCP_ROUTE_DOMAIN>"

===  Uninstalling the Chart

To uninstall the bamoe-consoles deployment:

    $ helm uninstall bamoe-consoles


===  Passing Environmental variables

This chart uses default environmental variables from the `values.yaml`file. You can override the variables by passing them through the command line.

    $ helm install my-bamoe-consoles ./src --set runtime-tools-consoles-helm-chart.task-console.image.registry=quay.io --set runtime-tools-consoles-helm-chart.management-console.image.account=bamoe

===  Configuration

The following table lists the configurable parameters of the Runtime Tools Consoles helm chart and their default values.

|===
| Key | Type | Default |Description
 
| global.dataIndexUrl
| string
| ""
| Set the URL that points to the Data-Index service

| global.ingressSource
|string
| ""
| Which ingress source is being used (none/"minikube"/"kubernetes"/"openshift") Obs.: For NOTES generation only
 
| global.kubernetesClusterDomain
| string
| ""
| If using Minikube or Kubernetes, set the cluster domain
 
| global.kubernetesIngressClass
| string
| ""
| If using Minikube or Kubernetes, set the Ingress class (i.e: nginx)

|  global.openshiftRouteDomain
| string
| ""
| If using OpenShift Routes, set the Route domain

|  fullnameOverride
| string
| ""
| Overrides charts full name

|  nameOverride
| string
| ""
| Overrides charts name

|  runtime-tools-consoles-helm-chart.management-console.appNameOverride
| string
| ""
| Overrides the deployed application name

|  runtime-tools-consoles-helm-chart.management-console.appVersionOverride
| string
| ""
| Overrides the deployed application version

|  runtime-tools-consoles-helm-chart.management-console.autoscaling
| object
| {"enabled":false,"maxReplicas":100,"minReplicas":1,"targetCPUUtilizationPercentage":80}
| Management Console HorizontalPodAutoscaler configuration (_https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/_)

|  runtime-tools-consoles-helm-chart.management-console.enabled
| bool
| true
| Enable or disable Management Console installation

|  runtime-tools-consoles-helm-chart.management-console.fullnameOverride
| string
| ""
| Overrides charts full name

|  runtime-tools-consoles-helm-chart.management-console.image
| object
| {"account":"apache","name":"incubator-kie-kogito-management-console","pullPolicy":"IfNotPresent","registry":"docker.io","tag":"main"}
| Image source configuration for the Management Console image

|  runtime-tools-consoles-helm-chart.management-console.imagePullSecrets
| list
| []
| Pull secrets used when pulling Management Console image

|  runtime-tools-consoles-helm-chart.management-console.ingress
| object
| {"annotations":{},"className":"{{ .Values.global.kubernetesIngressClass }}","enabled":false,"hosts":[{"host":"management-console.{{ .Values.global.kubernetesClusterDomain }}","paths":[{"path":"/","pathType":"ImplementationSpecific"}]}],"tls":[]}
| Management Console Ingress configuration (_https://kubernetes.io/docs/concepts/services-networking/ingress/_)

|  runtime-tools-consoles-helm-chart.management-console.name
| string
| "management-console"
| Component name

|  runtime-tools-consoles-helm-chart.management-console.nameOverride
| string
| ""
| Overrides charts name

|  runtime-tools-consoles-helm-chart.management-console.nodeSelector
| object
| {}
| 

|  runtime-tools-consoles-helm-chart.management-console.openshiftRoute
| object
| {"annotations":{},"enabled":false,"host":"management-console.{{ .Values.global.openshiftRouteDomain }}","tls":{"insecureEdgeTerminationPolicy":"None","termination":"edge"}}
| Management Console OpenShift Route configuration (_https://docs.openshift.com/container-platform/4.14/networking/routes/route-configuration.html_)

|  runtime-tools-consoles-helm-chart.management-console.service
| object
| {"nodePort":"","port":8081,"targetPort":8080,"type":"ClusterIP"}
| Management Console Service configuration (_https://kubernetes.io/docs/concepts/services-networking/service/_)

|  runtime-tools-consoles-helm-chart.management-console.serviceAccount
| object
| {"annotations":{},"create":true,"name":""}
| Management Console ServiceAccount configuration (_https://kubernetes.io/docs/concepts/security/service-accounts/_)

|  runtime-tools-consoles-helm-chart.task-console.appNameOverride
| string
| ""
| Overrides the deployed application name

|  runtime-tools-consoles-helm-chart.task-console.appTaskActiveStatesListOverride
| string
| ""
| Overrides the Task Console active states list

|  runtime-tools-consoles-helm-chart.task-console.appTaskStatesListOverride
| string
| ""
| Overrides the Task Console states list

|  runtime-tools-consoles-helm-chart.task-console.appVersionOverride
| string
| ""
| Overrides the deployed application version

|  runtime-tools-consoles-helm-chart.task-console.autoscaling
| object
| {"enabled":false,"maxReplicas":100,"minReplicas":1,"targetCPUUtilizationPercentage":80}
| Task Console HorizontalPodAutoscaler configuration (_https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/_)

|  runtime-tools-consoles-helm-chart.task-console.enabled
| bool
| true
| Enable or disable Task Console installation

|  runtime-tools-consoles-helm-chart.task-console.fullnameOverride
| string
| ""
| Overrides charts full name

|  runtime-tools-consoles-helm-chart.task-console.image
| object
| {"account":"apache","name":"incubator-kie-kogito-task-console","pullPolicy":"IfNotPresent","registry":"docker.io","tag":"main"}
| Image source configuration for the Management Console image

|  runtime-tools-consoles-helm-chart.task-console.imagePullSecrets
| list
| []
| Pull secrets used when pulling Management Console image

|  runtime-tools-consoles-helm-chart.task-console.ingress
| object
| {"annotations":{},"className":"{{ .Values.global.kubernetesIngressClass }}","enabled":false,"hosts":[{"host":"task-console.{{ .Values.global.kubernetesClusterDomain }}","paths":[{"path":"/","pathType":"ImplementationSpecific"}]}],"tls":[]}
| Task Console Ingress configuration (_https://kubernetes.io/docs/concepts/services-networking/ingress/_)

|  runtime-tools-consoles-helm-chart.task-console.name
| string
| "task-console"
| Component name

|  runtime-tools-consoles-helm-chart.task-console.nameOverride
| string
| ""
| Overrides charts name

|  runtime-tools-consoles-helm-chart.task-console.openshiftRoute
| object
| {"annotations":{},"enabled":false,"host":"task-console.{{ .Values.global.openshiftRouteDomain }}","tls":{"insecureEdgeTerminationPolicy":"None","termination":"edge"}}
| Task Console OpenShift Route configuration (_https://docs.openshift.com/container-platform/4.14/networking/routes/route-configuration.html_)

|  runtime-tools-consoles-helm-chart.task-console.service
| object
| {"nodePort":"","port":8080,"targetPort":8080,"type":"ClusterIP"}
| Task Console Service configuration (_https://kubernetes.io/docs/concepts/services-networking/service/_)

|  runtime-tools-consoles-helm-chart.task-console.serviceAccount
| object
| {"annotations":{},"create":true,"name":""}
| Task Console ServiceAccount configuration (_https://kubernetes.io/docs/concepts/security/service-accounts/_)
|===

== Management Console Docker Image

The Management Console image is published to Quay.io and can be used to run containers locally or with any cloud provider.

* Management Console → https://quay.io/repository/bamoe/management-console[quay.io/bamoe/management-console] @ {VERSION}

=== Configuration

The following table lists the configuration envs of the Management Console Image:

|===
| Name | Description | Type | Default

| RUNTIME_TOOLS_MANAGEMENT_CONSOLE_KOGITO_ENV_MODE
| Starts the Management Console in "PROD" or "DEV" Mode. "PROD" mode enables authentication.
| string
| "DEV"

| RUNTIME_TOOLS_MANAGEMENT_CONSOLE_DATA_INDEX_ENDPOINT
| Sets the Data-Index Service GraphQL URL
| string
| "http://localhost:8180"

| KOGITO_CONSOLES_KEYCLOAK_URL
| The base URL of the Keycloak server. All other Keycloak server pages and service URLs are derived from the base URL.
| string
| "http://localhost:8280/auth"

| KOGITO_CONSOLES_KEYCLOAK_REALM
| Sets the realm, containing all the security configurations
| string
| "kogito"

| KOGITO_CONSOLES_KEYCLOAK_CLIENT_ID
| The client ID of the application. Each application contains a client ID that is used to identify the application.
| string
| "kogito-console-react"

| KOGITO_CONSOLES_KEYCLOAK_HEALTH_CHECK_URL
| The health check URL that is used to check if the Keycloak server started properly.
| string
| "http://localhost:8280/auth/realms/kogito/.well-known/openid-configuration"

| KOGITO_CONSOLES_KEYCLOAK_DISABLE_HEALTH_CHECK
| In "PROD" mode, disables the Keycloack health check
| true/false
| false

| KOGITO_CONSOLES_KEYCLOAK_UPDATE_TOKEN_VALIDITY
| The property indicates the minimum validity (in seconds) of the token. If the token expires within the specified time, the token is refreshed.
| number
| 30
|===
