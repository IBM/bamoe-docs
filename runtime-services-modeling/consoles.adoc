= Managing live Workflows using BAMOE Management Console
include::../partials/attributes.adoc[]
include::../styles/images.adoc[]

{MANAGEMENT_CONSOLE} is a web application for viewing the state of all available {PRODUCT_SHORT} services and manage and interact with Process instances:

.{MANAGEMENT_CONSOLE}
image::runtime-services-modeling/mgmt-console-process-instances.png[Image of {MANAGEMENT_CONSOLE}]

You can use {MANAGEMENT_CONSOLE} to manage and interact with Process instances, manage User Tasks and Jobs. These are the different elements you can view:

* Process instances
* Process instances subprocesses
* Details of Node instances
* Domain-specific Process data
* Jobs
* User Tasks

In order to be compatible with {MANAGEMENT_CONSOLE} your {PRODUCT_SHORT} services must use the following {PRODUCT_SHORT} components:

* *{PRODUCT_SHORT} Data-Index service*: Enables the {MANAGEMENT_CONSOLE} to access stored events related to processes and domain data from your {PRODUCT_SHORT} services. The Data-Index service requires PostgreSQL persistence.
* *{PRODUCT_SHORT} Process management add-on*: Enables the {MANAGEMENT_CONSOLE} to interact with the Process data from your {PRODUCT_SHORT} services through the add-on REST endpoint `/management/processes`.
If you do not enable this add-on for your {PRODUCT_SHORT} service, the {MANAGEMENT_CONSOLE} provides read-only access to your service data without the ability to modify instances, such as aborting Process instances.

To visualize the process instance execution path at the {MANAGEMENT_CONSOLE}, add the following add-on:

* *{PRODUCT_SHORT} Process SVG add-on*: Enables the Process SVG diagram to visualize the process instance execution path.
If this add-on is not enabled for your {PRODUCT_SHORT} service, the {MANAGEMENT_CONSOLE} does not display the diagram panel.

---

== Using the {MANAGEMENT_CONSOLE} to manage process instances

You can use the {MANAGEMENT_CONSOLE} to view and manage process instance details from your {PRODUCT_SHORT} services.
You can run the {MANAGEMENT_CONSOLE} for local {PRODUCT_SHORT} services or add it to your {PRODUCT_SHORT} infrastructure on OpenShift.

.Prerequisites
* A {PRODUCT_SHORT} Data-Index Service instance is configured and running for your {PRODUCT_SHORT} service.
* The `pom.xml` file of your {PRODUCT_SHORT} project contains the following dependency for the process management add-on.
This add-on enables the {MANAGEMENT_CONSOLE} to interact with the process data through the add-on REST endpoint `/management/processes`.
+
.Project dependency to enable process management REST operations
[source,xml]
----
<dependency>
  <groupId>org.kie</groupId>
  <artifactId>kie-addons-quarkus-process-management</artifactId>
</dependency>
----


.Procedure
. In a terminal, enter the following command to run the {MANAGEMENT_CONSOLE} locally:
+
.Running the {MANAGEMENT_CONSOLE}
[source,shell,subs="attributes"]
----
docker run -p 8280:8080 quay.io/bamoe/management-console:{IMAGE_VERSION}
----
+
[NOTE]
====
The default port for the {MANAGEMENT_CONSOLE} is 8080, but this example specifies port 8280 to avoid conflicts with the example {PRODUCT_SHORT} service running at port 8080.
====

== {MANAGEMENT_CONSOLE} application

=== Connecting to a {PRODUCT_SHORT} service instance

image::runtime-services-modeling/mgmt-console-home-no-connections.png[Image of {MANAGEMENT_CONSOLE} home page without connections]

To do so, click on the **+ Connect to a runtime…** button and fill in the required information on the
modal:

- **Alias**: The name to give your connected {PRODUCT_SHORT} service instance (can be anything that helps you identify it).
- **URL**: The {PRODUCT_SHORT} service root URL (E.g., http://localhost:8080).
- **Force login prompt (for secured runtimes only)**: Check this if you are already logged in your Identity Provider but would like to log in again (maybe with a different user).

More settings are available in the **Advanced OpenID Connect settings** section:

- **Client ID**: Overrides the Client ID used for this connection. Defaults to the value of the `RUNTIME_TOOLS_MANAGEMENT_CONSOLE_OIDC_CLIENT_CLIENT_ID` environment variable.
- **Scope**: Overrides the scopes requested to the Identity Provider. Useful from some Identity Providers that, for example, will only grant a Refresh Token if the `offline_access` scope is included in the token request. Defaults to `openid email profile`.
- **Audience**: This is the `audience` parameter in the Authorization request. Used to identify the service that the token is intended for. Empty by default.

image::runtime-services-modeling/mgmt-console-home-add-connection-modal-filled.png[Image of {MANAGEMENT_CONSOLE} new connection modal]

If your {PRODUCT_SHORT} service uses OpenID Connect authentication, you should be redirected to the Identity Provider
(IdP) login page or, if you’re already logged in, redirected back to the {MANAGEMENT_CONSOLE}. If your
{PRODUCT_SHORT} service is unsecured, it should connect directly.

Once logged in, the management pages will be displayed in the side menu, listing Process Instances,
Jobs, and Tasks.

image::runtime-services-modeling/mgmt-console-home-add-connection-modal-secured.gif[Image of {MANAGEMENT_CONSOLE} new connection modal]

---

== The {MANAGEMENT_CONSOLE} application

{MANAGEMENT_CONSOLE} consists of the following tabs that allow you to interact with your process instances and data:

* *Process Instances*: List process and subprocess instances and filter them by status or business key;

* *Jobs*: List available jobs, filter them by status, and perform actions for any individual one, such as view details, reschedule, or cancel.

* *Tasks*: List User Tasks from Processes, filter them by status or name, and submit forms to fulfill tasks.

=== Process Instances

.Process Instances tab
image::runtime-services-modeling/mgmt-console-process-instances.png[Image of Process Instance list section]

The Process Instances tab shows the list of process instances available. They are displayed in an expandable list, which shows all the child process instances of the particular process instance when expanded.

Each row in the list contains the information about the process instance, including details like _name_, _status_, _endpoint_ etc. The list also provides many ways to filter out the process instances and perform management operations.



.Process Details page
image::runtime-services-modeling/mgmt-console-process-instances-details.png[Image of Process Instance details in {MANAGEMENT_CONSOLE}]

The *Process Details* page consists of the following panels:

* Process Diagram panel
* Details panel
* Process Variables panel
* Timeline panel
* Node Trigger panel
* Milestones panel
* Jobs panel


==== Process Diagram panel:
--
This panel enables you to explore the Process diagram and execution path of the related process instance.
The execution path is displayed when the {MANAGEMENT_CONSOLE} finds the `.svg` resources using the {PRODUCT_SHORT} Process SVG add-on configuration included in the {MANAGEMENT_CONSOLE}.

.Process Diagram panel
image::runtime-services-modeling/mgmt-console-process-diagram-panel.png[Image of Process instance diagram panel]

This panel includes different controls to view the Process diagram, such as *Selection*, *Pan*, *Zoom in*, *Zoom out*, and *Fit to viewer*.
--

==== Details panel:
--
This panel displays the basic Process instance information and provides links to the related Process runtime UI.
If the Process instance is related to other Process instances, then links to the parent and subprocess instances are also available in the *Details* panel.

.Details panel
image::runtime-services-modeling/mgmt-console-details-panel.png[Image of Process instance details panel]

The Details panel consists of the following fields:

* *Name*: The Process definition ID related to the Process instance.
* *Business key*: Optional business key of the Process instance.
* *State*: The state of the Process instance. The state of a Process instance can be pending, active, completed, aborted, suspended, or error.
* *Id*: The unique identifier of the Process instance.
* *Endpoint*: The endpoint of the Process instance. You can click the displayed endpoint to view the Process or application UI that triggered the Process instance.
+
.Process instance details endpoint
image::runtime-services-modeling/mgmt-console-process-details-endpoint.png[Image of Process instance details endpoint in {MANAGEMENT_CONSOLE}]

* *Start*: Time reference indicating when the Process instance is started.
* *Last Updated*: Time reference indicating when the Process instance is updated.
* *End*: Time reference indicating when the Process instance is completed.
* *Parent Process*: Parent Process instance of the instance (if linked). You can click and navigate to the parent Process instance.
* *Sub Processes*: Subprocess of the instance (if linked). You can click and navigate to the subprocess instances.
--

==== Process Variables panel:
--
The *Process Variables* panel displays the Process instance domain data in a tree structure.
When you hover the mouse on different elements, the available actions are displayed.

.Process Variables panel
image::runtime-services-modeling/mgmt-console-process-variable-panel.png[Image of Process variables panel  in {MANAGEMENT_CONSOLE}]

.Actions in Process Variables panel
image::runtime-services-modeling/mgmt-console-process-variable-actions.png[Image of Process variables panel available actions in {MANAGEMENT_CONSOLE}]

The process variables in the *Process Variables* panel consists of the following actions:

* Expand or collapse: Enables you to expand or collapse an element.
* Add item: Enables you to add a new key. When you add a new key, it contains null values, which you can edit if required.
+
.Add new key
image::runtime-services-modeling/mgmt-console-process-variable-add.png[Steps to add a new variable to a Process instance in {MANAGEMENT_CONSOLE}]

* Copy: Enables you to copy the selected value in clipboard.
* Edit: Enables you to edit the selected element value.
* Remove: Enables you to remove the selected element.

If there are pending changes to be saved, the panel displays *Changes are not saved yet* message.
To save the changes that you made to the process variable, click *Save*, or click *Abort* to abort the changes.
If you want to revert the changes, click the refresh icon.
--

==== Timeline panel:
--
The *Timeline* panel displays the list of node instances related to the Process instance sorted by the start time.
Each node consists of an icon, indicating the state of the node, such as active, completed, or error.

.Timeline panel
image::runtime-services-modeling/mgmt-console-process-timeline-panel.png[Image of Timeline panel showing the related node instances]

The actions that are available for an active node include retriggering and canceling a node.
Whereas the actions for an error node include retrying and skipping the node.
The node actions in the *Timeline* panel are connected with the {PRODUCT_SHORT} runtime service to perform the requested action.

If a node in the *Timeline* panel is associated with a job, then select the clock icon to view the job details or click the menu for additional job operations, such as *Job Reschedule* or *Job Cancel*.
--

==== Node Trigger panel:
--
The *Node Trigger* panel displays the list of all process definition nodes in a drop-down.
When you select a node, the related information is displayed, such as *Node name*, *Node type*, and *Node id*.
Click the *Trigger* button, to trigger the selected node.

.Node Trigger panel
image::runtime-services-modeling/mgmt-console-node-trigger-panel.png[Image of node trigger panel in {MANAGEMENT_CONSOLE}]
--

==== Milestones panel:
--
The *Milestones* panel displays a list of the milestones for the Process instance, if applicable.

.Milestones panel
image::runtime-services-modeling/mgmt-console-milestones-panel.png[Image of milestones panel in {MANAGEMENT_CONSOLE}]
--

==== Jobs panel:
--
The *Jobs* panel displays the list of available jobs that are related to the Process instance.

.Jobs panel
image::runtime-services-modeling/mgmt-console-jobs-panel.png[Image of jobs panel in {MANAGEMENT_CONSOLE}]

.Job details
image::runtime-services-modeling/mgmt-console-jobs-panel-details.png[Image of jobs panel details in {MANAGEMENT_CONSOLE}]

You can reschedule or cancel a job that is in scheduled or error state.
You can also modify the expiration time for one-time jobs and repeat interval, repeat time, and expiration time for the periodic jobs.
--

=== Jobs

The *Jobs Management* tab displays the list of existing jobs, which you can filter and perform related management actions such as viewing job details, rescheduling a job, or canceling a job.

.Jobs Management page
image::runtime-services-modeling/mgmt-console-jobs-management.png[Image of Jobs Management page in {MANAGEMENT_CONSOLE}]

You can also cancel the multiple jobs at the same time.
To cancel multiple jobs, select the jobs to be canceled and click the *Cancel Selected* button.

=== Tasks

---

=== Enabling {MANAGEMENT_CONSOLE} security

For security, the {MANAGEMENT_CONSOLE} relies on https://www.keycloak.org/[Keycloak] solution for authentication.
Once a user is authenticated, {MANAGEMENT_CONSOLE} uses bearer tokens to communicate with other {PRODUCT_SHORT} services.

IMPORTANT: By default, To enable security it is required to run {MANAGEMENT_CONSOLE} in "PROD" mode.

.Prerequisites
* You have a https://www.keycloak.org/[Keycloak] server running.

IMPORTANT: Ensure that you log in to the Keycloak administration console, navigate to the respective client configuration, and add correct URLs of different applications.
For easier configuration, you can add ***  in the *Web Origins*, however, it can cause security issues.
You can also add the origin URLs as a parameter to the *Web Origins*, which can prevent the issues related to `Access-Control-Allow-Origin`.

image::runtime-services-modeling/kogito-consoles-keycloak-config.png[Image of client config in keycloak server]

.Procedure
In a command terminal, enter the following command to run the {MANAGEMENT_CONSOLE}:

.Run the {MANAGEMENT_CONSOLE} with security enabled
[source,subs="attributes"]
----
$ docker run -e RUNTIME_TOOLS_MANAGEMENT_CONSOLE_KOGITO_ENV_MODE=PROD
  -e KOGITO_CONSOLES_KEYCLOAK_URL=http://localhost:8480/auth
  -e KOGITO_CONSOLES_KEYCLOAK_REALM=kogito
  -e KOGITO_CONSOLES_KEYCLOAK_CLIENT_ID=kogito-console-react
  -p 8280:8080 quay.io/bamoe/management-console:{IMAGE_VERSION}
----

== Tasks

The Task Console is a user interface for viewing and interacting with user tasks in {PRODUCT_SHORT} Process services.

.Tasks
image::runtime-services-modeling/kogito-task-console.png[Image of Kogito Task Console]

You can use the Task Console to view your list of assigned tasks, view the task details for each task, and move the task to the next phase of the task lifecycle.

The Task Console requires your {PRODUCT_SHORT} services to use the {PRODUCT_SHORT} Data-Index Service.
The Data-Index Service enables the Task Console to access stored events related to tasks and domain data from your {PRODUCT_SHORT} services.

=== Configuration

The following table lists the configuration envs of the Task Console Image:

|===
| Name | Description | Type | Default

| RUNTIME_TOOLS_TASK_CONSOLE_KOGITO_ENV_MODE
| Starts the {MANAGEMENT_CONSOLE} in "PROD" or "DEV" Mode. "PROD" mode enables authentication.
| string
| "DEV"

| RUNTIME_TOOLS_TASK_CONSOLE_DATA_INDEX_ENDPOINT
| Sets the Data-Index Service GraphQL URL
| string
| "http://localhost:8180"

| RUNTIME_TOOLS_TASK_CONSOLE_KOGITO_TASK_STATES_LIST
| Comma-separated list of all the possible `Task States` to be used in the `Task Inbox` filters.
| string
| "Ready,Reserved,Completed,Aborted,Skipped"

| RUNTIME_TOOLS_TASK_CONSOLE_KOGITO_TASK_ACTIVE_STATES_LIST
| Comma-separated list of all the active `Task States` to be used in the `Task Inbox` filters.
| string
| "Ready,Reserved"

| KOGITO_CONSOLES_KEYCLOAK_URL
| The base URL of the Keycloak server. All other Keycloak server pages and service URLs are derived from the base URL.
| string
| "http://localhost:8280/auth"

| KOGITO_CONSOLES_KEYCLOAK_REALM
| Sets the realm, containing all the security configurations
| string
| "kogito"

| KOGITO_CONSOLES_KEYCLOAK_CLIENT_ID
| The client ID of the application. Each application contains a client ID that is used to identify the application.
| string
| "kogito-console-react"

| KOGITO_CONSOLES_KEYCLOAK_HEALTH_CHECK_URL
| The health check URL that is used to check if the Keycloak server started properly.
| string
| "http://localhost:8280/auth/realms/kogito/.well-known/openid-configuration"

| KOGITO_CONSOLES_KEYCLOAK_DISABLE_HEALTH_CHECK
| In "PROD" mode, disables the Keycloack health check
| true/false
| false

| KOGITO_CONSOLES_KEYCLOAK_UPDATE_TOKEN_VALIDITY
| The property indicates the minimum validity (in seconds) of the token. If the token expires within the specified time, the token is refreshed.
| number
| 30
|===

=== Using the Task Console to interact with user tasks

You can use the Task Console to view and interact with user tasks in {PRODUCT_SHORT} Process services.
You can run the Task Console for local {PRODUCT_SHORT} services or add it to your {PRODUCT_SHORT} infrastructure on OpenShift.

.Prerequisites
* A {PRODUCT_SHORT} Data-Index Service instance is configured and running for your {PRODUCT_SHORT} service.
The Data-Index Service enables the Task Console to access stored tasks and Process data.
The Data-Index Service requires Infinispan or MongoDB persistence and Apache Kafka messaging for your {PRODUCT_SHORT} service.
* The `application.properties` file of your {PRODUCT_SHORT} project contains the following system properties for the location where the {PRODUCT_SHORT} service is deployed, such as `\http://localhost:8080`, and for Quarkus Cross-Origin Resource Sharing (CORS) support.
+
.Application properties for REST URLs
[source,subs="+quotes"]
----
kogito.service.url=http://__HOST__:__PORT__
quarkus.http.cors=true
----

.Procedure
In a command terminal, enter the following command to run the Task Console:
--
.Running the Task Console
[source,subs="attributes"]
----
$ docker run -p 8280:8080 quay.io/bamoe/task-console:{IMAGE_VERSION}
----

[NOTE]
====
The default port for the Task Console is 8080, but this example specifies port 8280 to avoid conflicts with the example {PRODUCT_SHORT} service running at port 8080.

Also, the Task Console uses the default Data-Index Service port 8180.
If you modified this port in your Data-Index Service instance, you can set the new Data-Index URL using the `RUNTIME_TOOLS_TASK_CONSOLE_DATA_INDEX_ENDPOINT` environment variable like:
[source,subs="attributes"]
----
$ docker run -e RUNTIME_TOOLS_TASK_CONSOLE_DATA_INDEX_ENDPOINT=http:/_HOST_:_PORT_/graphql -p 8280:8080 quay.io/bamoe/task-console:{IMAGE_VERSION}
----
====

If your {PRODUCT_SHORT} project has a custom task lifecycle that defines custom states, you can use the following environment
variables to configure the Task Console to use those states and show them in the filters:

* `RUNTIME_TOOLS_TASK_CONSOLE_KOGITO_TASK_STATES_LIST`: Comma-separated list of values containing all the states that you want to show in the Task Console.
Without this property, the Task Console shows the default lifecycle states `Ready`, `Reserved`, `Completed`, `Aborted`, and `Skipped`.
* `RUNTIME_TOOLS_TASK_CONSOLE_KOGITO_TASK_ACTIVE_STATES_LIST`: Comma-separated list of values containing the active task states.
These states are used in the *Task Inbox* default filter. Without this property, the default active states are `Ready` and `Reserved`.

.Configuring custom task states for the Task Console
[source,subs="attributes"]
----
$ docker run -e RUNTIME_TOOLS_TASK_CONSOLE_KOGITO_TASK_STATES_LIST=Started,Pending,Finished,Cancelled -e RUNTIME_TOOLS_TASK_CONSOLE_KOGITO_TASK_ACTIVE_STATES_LIST=Started,Pending -p 8280:8080 quay.io/bamoe/task-console:{IMAGE_VERSION}
----

.Task Console
image::runtime-services-modeling/kogito-task-console.png[Image of Kogito Task Console]

In this example, the Task Console displays data for the `kogito-travel-agency` extended example application in the xref:../getting-started/examples.html[list of example applications].

The *Task Inbox* page lists the available user tasks that you can interact with.
You can use the upper toolbar options to filter the tasks or use the column headers to sort the tasks as needed.
You can also search for tasks by the full name or by partial name, such as `Apply`.

.Tasks assigned to the current user
image::runtime-services-modeling/kogito-task-console-inbox.png[Image of the tasks assigned to the current user]

.Available task status filters
image::runtime-services-modeling/kogito-task-console-filters-status.png[Image of status filtering on *Task Inbox*]

.Applied filters
image::runtime-services-modeling/kogito-task-console-filters.png[Image of status and names filtering on *Task Inbox*]

Select a task name to view task details and interact with the task:

.Task details
image::runtime-services-modeling/kogito-task-console-details-page.png[Image of *Task Details* page]

Depending on the current phase of the selected task, you can select from the available actions for that task, such as *Abort*, *Release*, *Skip*, or *Complete*, to move the task to the next phase.

For additional task details, you can select *View details*. This panel lists the task ID, state, owner, related Process instance ID, and other helpful information about the task.

.Task details panel
image::runtime-services-modeling/kogito-task-console-details-expanded.png[Image of task details panel]
--

=== Enabling Task Console security

For security, Task Console relies on https://www.keycloak.org/[Keycloak] solution for authentication.
Once a user is authenticated, Task Console uses bearer tokens to communicate with other {PRODUCT_SHORT} services.

IMPORTANT: By default, To enable security it is required to run {MANAGEMENT_CONSOLE} in "PROD" mode.

.Prerequisites
* You have a https://www.keycloak.org/[Keycloak] server running.

IMPORTANT: Ensure that you log in to the administration console of the Keycloak, navigate to the respective client configuration, and add correct URLs of different applications.
For easier configuration, you can add ***  in the *Web Origins*, however, it can cause security issues.
You can also add the origin URLs as a parameter to the *Web Origins*, which can prevent the issues related to `Access-Control-Allow-Origin`.

image::runtime-services-modeling/kogito-consoles-keycloak-config.png[Image of client config in keycloak server]

.Procedure
In a command terminal, enter the following command to run the Task Console:

.Run the Task Console with security enabled
[source,subs="attributes"]
----
$ docker run -e RUNTIME_TOOLS_TASK_CONSOLE_KOGITO_ENV_MODE=PROD
  -e KOGITO_CONSOLES_KEYCLOAK_URL=http://localhost:8480/auth
  -e KOGITO_CONSOLES_KEYCLOAK_REALM=kogito
  -e KOGITO_CONSOLES_KEYCLOAK_CLIENT_ID=kogito-console-react
  -p 8280:8080 quay.io/bamoe/task-console:{IMAGE_VERSION}
----